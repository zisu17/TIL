# 스노우플레이크 소개
120개 이상의 데이터 베이스 특허를 가진 업계의 베테랑들이 2012년 회사 설립

Snowflake의 개발 목표는 기존의 데이터 웨어하우스 시스템의 한계를 극복하고 클라우드 기반의 혁신적인 데이터 처리 솔루션을 제공하기 위해서 클라우드 환경에서의 엔터프라이즈급 데이터 웨어하우스를 구축하기 위해 아키텍처와 기술을 개발

2014년에 Snowflake의 첫 번째 제품 버전이 출시되었으며 기업들은 Snowflake의 혁신적인 아키텍처와 클라우드 기반의 이점을 경험하고자 이를 받아들였습니다. Snowflake는 고성능, 확장성, 유연성, 데이터 공유 및 보안 기능 등을 갖춘 데이터 웨어하우스 플랫폼으로 인정받게됨.

그 후 Snowflake는 지속적으로 기능을 개선하고 새로운 기능을 추가하여 데이터 분석과 처리를 위한 선도적인 역할을 수행함 클라우드 플랫폼과의 파트너십을 확장하여 AWS, Azure, GCP와 같은 주요 클라우드 제공업체와의 협력을 하고있음

Snowflake는 현재 데이터 웨어하우스 분야에서 많은 기업들이 선택하는 솔루션이며 다양한 산업 분야에서 데이터 분석, 비즈니스 인텔리전스, 대시보드 및 실시간 분석 등 다양한 목적으로 사용되고 있다.


# 전통적인 데이터 아키텍처
과거엔 크게 두 가지 아키텍처 Shared-disk(SMP), Shared_nothing(MPP)를 주로 사용했지만 스노우플레이크는 클라우드 네이티브한 데이터 베이스를 지향함

전통적인 데이터 플랫폼을 구축하게 되면 미리 섬세한 클러스터 사이징을 고려해야하고 운영 관리 오버헤드, 소프트웨어 업그레이드에 따른 다운타임 발생, 노드 추가에 대한 오버헤드 등이 존재함

시간대별 작업 분배로 최적화를 수행하거나 제한된 분석 워크로드만 수용함


# 스노우플레이크의 아키텍처
![image](https://github.com/zisu17/TIL/assets/108858121/ded35432-2ce6-4c63-bb34-f1113fb315a3)

- 여러 Virtual Warehouse를 사용
- 튜닝, 파티셔닝, 최적화 인덱싱 등이 필요하지 않음
- 저렴한 비용으로 오브젝트 스토리지 사용
- 사용한 만큼의 과금이 됨, 시간 (트랜잭션 시간 등만 과금이 됨)
- 운영 중에 컴퓨팅 사이즈를 자유롭게 늘릴 수 있음
- 서버 한 대 8코어 16기가
- 컴퓨팅 스펙에 따라 과금이 되기보단 시간 단위 과금이 이뤄지기 때문에 스몰 사이즈보다 라지 사이즈가 더 적은 과금이 될 수 있음

# Multi-cluster, Shared data (MCSD)

Multi-cluster, Shared data (MCSD)는 스노우플레이크의 데이터 공유 기능을 향상시키기 위해 도입된 기술입니다. 이 기능은 여러 클러스터 간에 데이터를 공유하고 동시에 처리할 수 있도록 지원한다.

- 데이터 공유 (Data Sharing): MCSD는 여러 클러스터 간에 데이터를 공유할 수 있는 기능을 제공함. 데이터 소유자는 자체 클러스터에서 생성한 데이터를 다른 클러스터와 공유할 수 있으며 데이터를 공유하기 위해 명시적인 권한을 부여한다.

- 외부 데이터 공유 (External Data Sharing): MCSD는 외부 클러스터에서 생성된 데이터를 스노우플레이크 클러스터와 공유할 수 있는 기능도 제공하고 이를 통해 다른 조직이나 데이터 제공자가 스노우플레이크 클러스터로 데이터를 공유할 수 있게 된다.

- 동시 처리 (Concurrent Processing): MCSD는 여러 클러스터가 동시에 데이터를 처리할 수 있도록 지원한다. 데이터 소비자는 공유된 데이터를 사용하여 동시에 분석 작업을 수행할 수 있으며 데이터 소유자와는 독립적으로 데이터를 변경하거나 업데이트할 수 있다.

MCSD는 스노우플레이크의 데이터 공유 및 협업 기능을 강화하여 다양한 조직 간에 데이터를 쉽게 공유하고 활용할 수 있도록 도와준다.


# 스노우플레이크 캐시 레이어
![image](https://github.com/zisu17/TIL/assets/108858121/bd3b332e-2b53-4936-b63c-ff6bed9133f1)

결과 캐시(Result Cache): 지난 24시간 동안 실행된 모든 쿼리의 결과를 저장하는 곳. 가상 웨어하우스 간에 공유되므로 동일한 쿼리를 실행하는 다른 사용자들도 동일한 쿼리 결과에 접근할 수 있다. 단, 기본 데이터가 변경되지 않았을 경우에만 가능하다.

로컬 디스크 캐시(Local Disk Cache): SQL 쿼리에서 사용되는 데이터를 캐싱하는 데 사용된다. 특정 쿼리에 필요한 데이터가 있을 때는 원격 디스크 저장소에서 검색되며 SSD와 메모리에 캐싱된다.

원격 디스크(Remote Disk): 장기 저장을 담당하는 곳. 이 레벨은 데이터의 내구성을 보장한다. 예를 들어, AWS의 경우 99.999999999%의 내구성을 제공합니다. 심지어 전체 데이터 센터 장애의 경우에도 데이터가 유지된다.

# Query Acceleration Service (QAS)

스노우플레이크의 Query Acceleration Service (QAS)는 쿼리 성능을 향상시키기 위해 도입된 서비스. 효율적인 쿼리 처리를 위해 스노우플레이크의 기능과 기술을 최적화하여 제공한다.

QAS 주요 기능

- 인덱싱 및 메타데이터: QAS는 데이터에 대한 인덱스를 생성하여 쿼리 성능 향상시킴. 인덱싱을 통한 빠른 데이터 접근 및 쿼리 응답 시간 단축. 메타데이터를 활용하여 쿼리 옵티마이저가 실행 계획을 최적화할 수 있음.

- 자동화된 성능 최적화: QAS는 자동 성능 최적화 기능을 제공하여 쿼리 실행을 자동으로 최적화한다. 쿼리의 처리 속도와 효율성을 최대화하고 사용자는 수동으로 성능 튜닝을 수행하지 않아도 됨.

- 캐싱 및 메모리 관리: QAS는 쿼리 결과를 캐싱하여 재사용 가능하도록 유지함. 캐시된 결과는 반복적인 쿼리 실행 시 디스크 액세스를 피하고 메모리에서 즉시 반환되어 응답 시간을 단축시킴. 메모리 관리를 최적화하여 메모리 용량을 효율적으로 사용한다.

- 데이터 파티셔닝: QAS는 데이터 파티셔닝을 지원하여 대용량 데이터를 분할하여 처리할 수 있다. 데이터 파티셔닝을 통해 쿼리의 성능이 향상되고 데이터에 대한 접근이 최적화된다.


## 권한없는 사용자의 데이터 획득 방지
컬럼 데이터 마스킹, Row 데이터 접근 제어 기능

데이터 익명화 함수 기능 제공

## 데이터 거버넌스
데이터 허브를 통해 데이터 거버넌스 제공

## 스노우플레이크 CDC 커넥터 지원
OLTP 데이터베이스와의 연동을위한 CDC 커넥터 지원

## UNISTORE (OLTP 테이블 지원)

## SNOWPARK 컴포넌트
snowpark 작동방식


# 데이터 마켓플레이스
데이터를 실제로 사고파는 환경
데이터 강화 : 스노우플레이크 마켓플레이스에 등록된 외부 데이터를 활용하여 데이터를 강화함
데이터 수익화 : 자사 데이터를 마켓플레이스에 등록하여 데이터를 활용한 새로운 수익 모델을 창출함

스노우플레이크 마켓플레이스는 스노우플레이크 사용자들이 데이터 분석을 위해 다양한 데이터와 서비스를 공유하고 활용할 수 있는 플랫폼이 있다. 마켓플레이스는 데이터 공급자와 데이터 소비자 간의 연결을 도와주며 다른 조직이나 사용자가 생성한 데이터를 검색하고 구매하여 자신의 분석 작업에 활용할 수 있도록 한다.

마켓플레이스는 공용 데이터 세트, 데이터 파이프라인 템플릿, 분석 알고리즘, 연동 서비스 및 커넥터 등 다양한 항목이 있음. 데이터 소비자는 필요한 데이터나 서비스를 마켓플레이스에서 선택하여 사용할 수 있으며, 데이터 공급자는 자체 데이터를 마켓플레이스에 등록하여 수익을 창출하거나 다른 조직과의 협업을 진행할 수 있음.


## 데이터 쉐어링
이 기종 DBMS 간의 데이터 동기화 이슈
이기종 환경 간의 데이터 복사 및 이동 필요
데이터 동기화 지연 발생 : 업무 영향도 발생
데이터 파이프라인 생성 및 관리 > 비용 이슈가 있음
데이블 개수 만큼 n개의 파이프라인 생성 및 관리가 필요함

스노우플레이크는 데이터 프로바이더와 컨슈머 관점에서 작동
라이브 데이터를 공유하여 데이터 동기화 파이프라인 불필요하고 데이터 메타 정보만 공유함
스노우플레이크가 퍼블릭 클라우드 기술을 쓰고 있기 때문에 가능함
예를 들어 S3를 볼 때 논리적으로는 어카운트마다 서로 다른 공간을 쓰지만 물리적으로는 하나의 환경이기 때문에 가능함
파이프라인 자체가 제거가 됨

데이터 쉐어링을 하기 위해선 프로바이더와 컨슈머 둘 다 스노우플레이크를 사용해야하는가?
단뱡향 데이터 공유라면 프로바이더 측은 스노우플레이크를 사용해야하고 컨슈머는 사용하지 않아도 됨


# 스노우플레이크의 컴퓨팅 노드와 데이터 노드
스노우플레이크 아키텍처에서 컴퓨팅 노드(Compute Node)와 데이터 노드(Data Node)는 중요한 역할을 수행하는 구성 요소이다.

컴퓨팅 노드(Compute Node):
컴퓨팅 노드는 데이터 웨어하우스에서 쿼리 처리 및 데이터 계산을 담당하는 역할을 수행한다. 컴퓨팅 노드는 사용자의 쿼리를 받아들이고, 해당 쿼리를 분석하여 데이터 스토리지로부터 필요한 데이터를 가져와 처리한다. 이후 결과를 반환하여 사용자에게 제공한다.
컴퓨팅 노드는 가상 웨어하우스(Virtual Warehouse)라는 개념을 기반으로 작동한다. 가상 웨어하우스는 사용자가 할당한 컴퓨팅 리소스를 나타내는데, 각 가상 웨어하우스는 독립적으로 확장될 수 있으며, 사용자의 요구에 따라 컴퓨팅 리소스를 동적으로 할당받아 작업을 수행한다.

데이터 노드(Data Node):
데이터 노드는 스노우플레이크의 데이터 스토리지를 담당하는 역할을 수행한다. 데이터 노드는 데이터 웨어하우스에 저장된 모든 데이터를 보유하고 있으며, 데이터를 안전하게 보관하고 쿼리 작업에 필요한 데이터를 제공한다.
데이터 노드는 데이터를 컬럼 기반으로 저장하며, 압축 및 인덱싱을 통해 데이터 액세스와 쿼리 성능을 최적화한다. 또한, 데이터 노드는 데이터의 복제와 분할 저장을 통해 내결함성과 확장성을 보장한다.

컴퓨팅 노드와 데이터 노드는 스노우플레이크 아키텍처에서 분리되어 작동하며, 이렇게 분리함으로써 데이터 처리 및 쿼리 성능을 향상시키고 확장성을 제공한다.


